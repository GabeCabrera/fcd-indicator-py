//@version=5
indicator("FCD Webhook (Final)", overlay=true)

// ============================================================================
// ALERT WITH DYNAMIC MESSAGE
// ============================================================================
if barstate.isconfirmed
    // Use chart's actual values
    string json = '{"symbol":"' + syminfo.ticker + 
                  '","timestamp":' + str.tostring(time) + 
                  ',"open":' + str.tostring(open) + 
                  ',"high":' + str.tostring(high) + 
                  ',"low":' + str.tostring(low) + 
                  ',"close":' + str.tostring(close) + 
                  ',"volume":' + str.tostring(volume) + '}'
    
    // Send alert with JSON
    alert(json, alert.freq_once_per_bar_close)

// ============================================================================
// VISUAL DISPLAY
// ============================================================================
var table t = table.new(position.top_right, 2, 4, bgcolor=color.new(color.black, 85), border_width=2)

if barstate.islast
    table.cell(t, 0, 0, "FCD Webhook", bgcolor=color.new(color.blue, 70), text_color=color.white)
    table.cell(t, 1, 0, "Ready", text_color=color.green)
    
    table.cell(t, 0, 1, "Symbol", text_color=color.white)
    table.cell(t, 1, 1, syminfo.ticker, text_color=color.yellow)
    
    table.cell(t, 0, 2, "Close", text_color=color.white)
    table.cell(t, 1, 2, str.tostring(close), text_color=color.white)
    
    table.cell(t, 0, 3, "Open", text_color=color.white)
    table.cell(t, 1, 3, str.tostring(open), text_color=color.white)

plotchar(barstate.isconfirmed, "Sent", "âœ“", location.belowbar, color.green, size=size.tiny)
